{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<!-- Meta Tags Essenciais -->
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

<!-- SEO e Meta Informações -->
<meta name="description" content="Jornal do Commercio - O mais tradicional veículo de comunicação de Pernambuco. Notícias, reportagens e cobertura completa.">
<meta name="keywords" content="notícias, pernambuco, recife, jornal, commercio, jc, política, economia, esportes">
<meta name="author" content="Jornal do Commercio">
<meta name="robots" content="index, follow">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="website">
<meta property="og:title" content="conteudo - Jornal do Commercio">
<meta property="og:description" content="As principais notícias de Pernambuco e do Brasil">
<meta property="og:image" content="{% static 'images/logo-jc.png' %}">

<!-- Favicon -->
<link rel="icon" type="image/png" href="{% static 'images/jc-favicon.png' %}">

<!-- Título -->
<title>{{ categoria.nome }} - Jornal do Commercio</title>

<!-- Fontes -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<!-- CSS - Ordem Importante -->
<link rel="stylesheet" href="{% static 'css/reset.css' %}">
<link rel="stylesheet" href="{% static 'css/variaveis.css' %}">
<link rel="stylesheet" href="{% static 'css/base.css' %}">
<link rel="stylesheet" href="{% static 'css/componentes.css' %}">
<link rel="stylesheet" href="{% static 'css/layout.css' %}?v=9">
<link rel="stylesheet" href="{% static 'css/menu_inferior.css' %}">
<link rel="stylesheet" href="{% static 'css/home-layout.css' %}">
<link rel="stylesheet" href="{% static 'css/nossos-produtos.css' %}">
<link rel="stylesheet" href="{% static 'css/responsivo.css' %}">
<link rel="stylesheet" href="{% static 'css/modal-cadastro.css' %}">
<link rel="stylesheet" href="{% static 'css/modal-feedback.css' %}">
<link rel="stylesheet" href="{% static 'css/radio-player.css' %}">
<link rel="stylesheet" href="{% static 'css/popup-busca.css' %}">

<!-- Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="{% static 'css/categoria.css' %}?v=2">
</head>
<body>

<!-- Barra Superior UOL -->
<div class="barra-uol">
  <div class="barra-uol-container">
    <a href="https://www.uol.com.br" target="_blank" rel="noopener noreferrer">
    <img src="https://conteudo.imguol.com.br/c/_layout/v3/logoUOL2021/logo_completo_white.svg" width="68" height="24" alt="UOL - O melhor conteúdo" title="UOL - O melhor conteúdo">
    </a>
  </div>
</div>

<div class="top-bar"></div>

{% include 'includes/menu_hamburguer.html' %}

<!-- Conteúdo Principal -->
<main class="conteudo-principal" id="conteudoPrincipal">
    <div class="container">
        <h1>{{ categoria.nome }}</h1>
        <div class="underline"></div>

        {% if noticias %}
            {% for noticia in noticias %}

                {% if forloop.first %}
                    <!-- Notícia em destaque -->
                        <a href="{% url 'noticia_detalhe' noticia.slug %}" class="cardCategoria" style="text-decoration: none; color: inherit;">
                            {% if noticia.imagem %}
                                <img src="{{ noticia.imagem.url }}" alt="{{ noticia.titulo }}">
                            {% endif %}
                            <div class="contentCategoria">
                                <span class="tagCategoria">{{ noticia.categoria.nome }}</span>
                                <h2 class="titleCategoria">{{ noticia.titulo }}</h2>
                                <p class="descCategoria">{{ noticia.subtitulo|truncatewords:100 }}</p>
                            </div>
                        </a>
                    {% if forloop.first %}

                        {% if noticias_relacionadas %}
                            <div class="noticias-relacionadas-container">
                                <div class="relacionadas-titulos-bar">
                                    <div class="relacionadas-bar"></div>
                                    <div class="relacionadas-titulos">
                                        {% for rel in noticias_relacionadas %}
                                            <a href="{% url 'noticia_detalhe' rel.slug %}" class="relacionadas-titulo-link">
                                                {{ rel.titulo }}
                                            </a>   
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        {% endif %}

                        {% if destaque_categoria %}
                            <h2>Destaques</h2>
                            <div class="underlineDescentralizado"></div>

                            <div class="carrossel-container">
                                <div class="carrossel">
                                    {% for noticia in destaque_categoria %}
                                        <a href="{% url 'noticia_detalhe' noticia.slug %}" class="carrossel-item">
                                            {% if noticia.imagem_vertical %}
                                                <img src="{{ noticia.imagem_vertical.url }}" alt="{{ noticia.titulo }}">
                                            {% elif noticia.imagem %}
                                                <img src="{{ noticia.imagem.url }}" alt="{{ noticia.titulo }}">
                                            {% endif %}
                                            <div class="texto">{{ noticia.titulo }}</div>
                                        </a>
                                    {% endfor %}
                                </div>
                            </div>
                            
                            <h2>Mais de cultura</h2>
                            <div class="underlineDescentralizado"></div>

                        {% endif %}

                    {% endif%}

                {% else %}
                    <a href="{% url 'noticia_detalhe' noticia.slug %}" class="news-item">
                        {% if noticia.imagem %}
                            <img src="{{ noticia.imagem.url }}" alt="{{ noticia.titulo }}" class="news-imageCategoria">
                            {% endif %}
                            <div class="news-content">
                                <span class="tag">{{ noticia.categoria.nome}}</span>
                                <h2 class="news-title">{{ noticia.titulo }}</h2>
                                <h2 class="news-descr">{{ noticia.subtitulo }} </h2>
                            </div>
                    </a>
                {% endif %}
            {% endfor %}
        {% else %}
            <p class="sem-noticias">Nenhuma notícia encontrada nesta categoria.</p>
        {% endif %}
</main>

{% include 'includes/menu_inferior.html' %}
{% include 'includes/radio_player.html' %}

<!-- Nossos Produtos -->
<section class="nossos-produtos">
<div class="nossos-produtos-container">
<h2 class="nossos-produtos-titulo">Nossos Produtos</h2>
<div class="produtos-grid">
<a href="https://www.ne10.uol.com.br/interior" target="_blank" class="produto-item" title="NE10 Interior">
<div class="produto-icone">
<img src="https://sjcc.ne10.uol.com.br/rodape_global/img/ne10interior.webp" alt="NE10 Interior">
</div>
<span class="produto-nome">NE10 Interior</span>
</a>

<a href="https://www.radiojornal.ne10.uol.com.br/" target="_blank" class="produto-item" title="Rádio Jornal">
<div class="produto-icone">
<img src="https://sjcc.ne10.uol.com.br/rodape_global/img/radio.webp" alt="Rádio Jornal">
</div>
<span class="produto-nome">Rádio Jornal</span>
</a>

<a href="https://tvjornal.ne10.uol.com.br/" target="_blank" class="produto-item" title="TV Jornal">
<div class="produto-icone">
<img src="https://sjcc.ne10.uol.com.br/rodape_global/img/tvjornal.webp" alt="TV Jornal">
</div>
<span class="produto-nome">TV Jornal</span>
</a>

<a href="https://jc.ne10.uol.com.br/" target="_blank" class="produto-item" title="Jornal do Commercio">
<div class="produto-icone">
<img src="https://sjcc.ne10.uol.com.br/rodape_global/img/jc-novo.webp" alt="Jornal do Commercio">
</div>
<span class="produto-nome">Jornal do Commercio</span>
</a>

<a href="https://www.blogdotorcedor.com.br/" target="_blank" class="produto-item" title="Blog do Torcedor">
<div class="produto-icone">
<img src="https://sjcc.ne10.uol.com.br/rodape_global/img/blog_do_torcedor.webp" alt="Blog do Torcedor">
</div>
<span class="produto-nome">Blog do Torcedor</span>
</a>

<a href="https://www.social1.com.br/" target="_blank" class="produto-item" title="Social1">
<div class="produto-icone">
<img src="https://sjcc.ne10.uol.com.br/rodape_global/img/social.webp" alt="Social1">
</div>
<span class="produto-nome">Social1</span>
</a>

<a href="https://www.receitadaboa.com.br/" target="_blank" class="produto-item" title="Receita da Boa">
<div class="produto-icone">
<img src="https://sjcc.ne10.uol.com.br/rodape_global/img/receita_da_boa.webp" alt="Receita da Boa">
</div>
<span class="produto-nome">Receita da Boa</span>
</a>
</div>
</div>
</section>

<!-- Rodapé -->
<footer class="rodape" id="rodape">
<div class="rodape-conteudo">
<div class="rodape-logo">
<img src="https://jc.uol.com.br/img/logo.svg" alt="Jornal do Commercio" class="logo-imagem">
<p>O jornal mais tradicional de Pernambuco</p>

<h3 class="rodape-redes-titulo">Nossas Redes</h3>
<div class="rodape-redes-sociais">
<a href="https://www.facebook.com/jornaldocommercio" target="_blank" class="icone-social icone-facebook" aria-label="Facebook">
<i class="fab fa-facebook-f"></i>
</a>
<a href="https://www.instagram.com/jornaldocommercio" target="_blank" class="icone-social icone-instagram" aria-label="Instagram">
<i class="fab fa-instagram"></i>
</a>
<a href="https://twitter.com/jornalcommercio" target="_blank" class="icone-social icone-twitter" aria-label="Twitter">
<svg xmlns="http://www.w3.org/2000/svg" width="34" height="35" viewBox="0 0 34 35" fill="none">
<circle cx="14.5946" cy="15.4054" r="14.5946" fill="#D9D9D9"/>
<path d="M11.1514 7.90039L11.1807 7.9375L15.4121 13.2725L20.6582 7.92969L20.6875 7.90039H22.4531L22.2861 8.07031L16.2012 14.2676L23.0781 22.9375L23.207 23.0996H17.8936L17.8633 23.0625L13.2607 17.2607L7.55859 23.0703L7.5293 23.0996H5.76172L5.92871 22.9297L12.4717 16.2666L5.96289 8.0625L5.83496 7.90039H11.1514ZM18.5391 21.8662H20.6084L10.5049 9.13086H8.43555L18.5391 21.8662Z" fill="#33363F" stroke="#33363F" stroke-width="0.2"/>
</svg>
</a>
<a href="https://www.linkedin.com/company/jornal-do-commercio" target="_blank" class="icone-social icone-linkedin" aria-label="LinkedIn">
<i class="fab fa-linkedin-in"></i>
</a>
<a href="https://www.youtube.com/@jornaldocommercio" target="_blank" class="icone-social icone-youtube" aria-label="YouTube">
<i class="fab fa-youtube"></i>
</a>
<a href="https://www.tiktok.com/@jornaldocommercio" target="_blank" class="icone-social icone-tiktok" aria-label="TikTok">
<i class="fab fa-tiktok"></i>
</a>
</div>
</div>

<div class="rodape-links">
<div class="rodape-coluna">
<h3>Canais</h3>
<ul>
<li><a href="{% url 'index' %}">Últimas Notícias</a></li>
<li><a href="#colunas">Colunas</a></li>
<li><button class="btn-feedback-footer" onclick="abrirModalFeedback()">Envie seu Feedback</button></li>
</ul>
</div>

<div class="rodape-coluna">
<h3>Institucionais</h3>
<ul>
<li><a href="#quem-somos">Quem Somos</a></li>
<li><a href="https://www.jcpm.com.br/sustentabilidade/" target="_blank">Práticas ASG JCPM</a></li>
<li><a href="https://ne10.uol.com.br/privacidade/" target="_blank">Privacidade</a></li>
<li><a href="#melhores-praticas">Melhores Práticas</a></li>
<li><a href="#lgpd">LGPD</a></li>
<li><a href="#publicacoes">Publicações</a></li>
<li><a href="#expediente">Expediente</a></li>
<li><a href="#fale-conosco">Fale Conosco</a></li>
<li><a href="https://sjcc.gupy.io/" target="_blank">Trabalhe Conosco</a></li>
</ul>
</div>

<div class="rodape-coluna">
<h3>Serviços</h3>
<ul>
<li><a href="#noticias-whatsapp">Notícias pelo WhatsApp</a></li>
<li><a href="#newsletter">Newsletter JC</a></li>
<li><a href="#publicidade-legal">Publicidade Legal</a></li>
<li><a href="https://ads.sjcc.com.br/?utm_source=jc_site&utm_medium=bt_anuncie_conosco&utm_campaign=anuncie_aqui_rodape&_gl=1*2yvvs*_ga*NzAwNTE0NTM1LjE3NTUyNjUzOTc.*_ga_S1QTC8L49Z*czE3NjE2NTkyMjMkbzI2JGcxJHQxNzYxNjYwNzk5JGoyOCRsMCRoMA.." target="_blank">Anuncie Conosco</a></li>
</ul>
</div>

<div class="rodape-coluna">
<h3>Aplicativos</h3>
<ul>
<li><a href="#app-jc">Jornal do Commercio</a></li>
<li><a href="#app-radio">Rádio Jornal</a></li>
</ul>
</div>
</div>
</div>

<div class="rodape-copyright">
<p>&copy; 2025 Jornal do Commercio. Todos os direitos reservados.</p>
</div>

<div class="rodape-grupo-jcpm">
<p class="rodape-grupo-texto">Jornal @ 2025 - Uma empresa do grupo JCPM</p>
<p class="rodape-licenciamento">PARA SOLICITAÇÃO DE LICENCIAMENTO, CONTACTAR EDITORES@NE10.COM.BR</p>
<img src="https://imagens.ne10.uol.com.br/jcpm/logo_jcpm_footer.svg" alt="Grupo JCPM" class="marca-grupo-jcpm">
</div>
</footer>

<!-- Modal de Cadastro -->
{% include 'cadastro_modal.html' %}

<!-- Modal de Login -->
{% include 'login_modal.html' %}

<!-- JavaScript -->
<script src="{% static 'js/app.js' %}"></script>
<script src="{% static 'js/navegacao.js' %}"></script>
<script src="{% static 'js/busca.js' %}"></script>
<script src="{% static 'js/noticias.js' %}"></script>
<script src="{% static 'js/header-animation.js' %}"></script>
<script src="{% static 'js/cadastro.js' %}"></script>
<script src="{% static 'js/login.js' %}"></script>
<script src="{% static 'js/feedback.js' %}"></script>
<script src="{% static 'js/radio-player.js' %}"></script>
<script>
    function toggleBookmark(event, noticiaId) {
        event.preventDefault();
        event.stopPropagation();

        const icon = event.currentTarget;
        const svg = icon.querySelector('svg');

        if (svg.getAttribute('fill') === 'none') {
            svg.setAttribute('fill', '#DE1B24');
            icon.style.opacity = '1';
        } else {
            svg.setAttribute('fill', 'none');
                icon.style.opacity = '0.4';
        }
    }

    function getNoticiasSalvasLocal() {
        const salvas = localStorage.getItem('noticiasSalvas');
        return salvas ? JSON.parse(salvas) : [];
    }

    function salvarNoticiaLocal(noticiaId) {
        const salvas = getNoticiasSalvasLocal();
        if (!salvas.includes(noticiaId)) {
            salvas.push(noticiaId);
            localStorage.setItem('noticiasSalvas', JSON.stringify(salvas));
        }
    }

    function removerNoticiaLocal(noticiaId) {
        let salvas = getNoticiasSalvasLocal();
        salvas = salvas.filter(id => id !== noticiaId);
        localStorage.setItem('noticiasSalvas', JSON.stringify(salvas));
    }

    function isNoticiaLocalmenteSalva(noticiaId) {
        return getNoticiasSalvasLocal().includes(noticiaId);
    }

    // Função para salvar/remover notícia
    function toggleSalvarNoticia(event) {
        event.preventDefault();
        event.stopPropagation();
        
        const btn = event.currentTarget;
        const noticiaId = btn.getAttribute('data-noticia-id');
        const isSalva = btn.getAttribute('aria-pressed') === 'true';

        {% if user.is_authenticated %}
            // Usuário autenticado: salva no backend
            const url = isSalva
            ? `/remover-noticia-salva/${noticiaId}/`
            : `/salvar-noticia/${noticiaId}/`;

            fetch(url, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/json',
                },
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Alterna o estado visual
                    btn.setAttribute('aria-pressed', !isSalva);
                    
                    // Mostra toast de sucesso
                    if (!isSalva) {
                        mostrarToast('Notícia salva!', 'sucesso');
                        btn.querySelector('svg').setAttribute('fill', '#DE1B24');
                        btn.querySelector('svg').setAttribute('stroke', '#DE1B24');
                    } else {
                        mostrarToast('Notícia removida dos salvos', 'info');
                        btn.querySelector('svg').setAttribute('fill', 'none');
                        btn.querySelector('svg').setAttribute('stroke', 'black');
                    }

                    // Feedback visual
                    btn.style.transform = 'scale(1.2)';
                    setTimeout(() => {
                        btn.style.transform = '';
                    }, 200);
                } else {
                    mostrarToast('Erro ao salvar notícia', 'erro');
                }
            })
            .catch(error => {
                console.error('Erro:', error);
                mostrarToast('Erro ao processar', 'erro');
            });
        {% else %}
            // Usuário não autenticado: salva no localStorage
            if (isSalva) {
                removerNoticiaLocal(noticiaId);
                btn.setAttribute('aria-pressed', 'false');
                mostrarToast('Notícia removida dos salvos', 'info');
                btn.querySelector('svg').setAttribute('fill', 'none');
                btn.querySelector('svg').setAttribute('stroke', 'black');
            } else {
                salvarNoticiaLocal(noticiaId);
                btn.setAttribute('aria-pressed', 'true');
                mostrarToast('Notícia salva!', 'sucesso');
                btn.querySelector('svg').setAttribute('fill', '#DE1B24');
                btn.querySelector('svg').setAttribute('stroke', '#DE1B24');

                // Feedback visual
                btn.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    btn.style.transform = '';
                }, 200);
            }
        {% endif %}
    }

    // Verificar estado inicial de salvamento quando a página carregar
    document.addEventListener('DOMContentLoaded', function() {
        const btn = document.querySelector('.salvar-btn');
        const noticiaId = btn.getAttribute('data-noticia-id');

        {% if user.is_authenticated %}
            // Usuário autenticado: verifica no backend
            fetch(`/verificar-noticia-salva/${noticiaId}/`)
            .then(response => response.json())
            .then(data => {
                if (data.salva) {
                    btn.setAttribute('aria-pressed', 'true');
                }
            })
            .catch(error => console.error('Erro ao verificar salvamento:', error));
        {% else %}
            // Usuário não autenticado: verifica no localStorage
            if (isNoticiaLocalmenteSalva(noticiaId)) {
                btn.setAttribute('aria-pressed', 'true');
            }
        {% endif %}
    });


    function compartilharNoticia(event) {
        event.preventDefault();
        event.stopPropagation();

        const newsItem = event.currentTarget.closest('.news-item');
        const titulo = newsItem.querySelector('.news-title').textContent;
        const url = newsItem.href;

        if (navigator.share) {
            // API nativa de compartilhamento
            navigator.share({
                title: titulo,
                text: 'Veja esta notícia do Jornal do Commercio',
                url: url
            }).catch(err => console.log('Compartilhamento cancelado'));
        } else {
            // Fallback - mostrar opções
            mostrarOpcoesCompartilhamento(titulo, url);
        }
    }

    function mostrarOpcoesCompartilhamento(titulo, url) {
        const modal = document.createElement('div');
        modal.className = 'modal-compartilhar-custom';
        modal.innerHTML = `
            <div class="modal-conteudo-custom">
                <h3>Compartilhar notícia</h3>
                <div class="opcoes-compartilhar">
                    <a href="https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}" target="_blank" class="opcao-compartilhar">
                        <i class="fab fa-facebook"></i> Facebook
                    </a>
                    <a href="https://twitter.com/intent/tweet?url=${encodeURIComponent(url)}&text=${encodeURIComponent(titulo)}" target="_blank" class="opcao-compartilhar">
                        <i class="fab fa-twitter"></i> Twitter
                    </a>
                    <a href="https://wa.me/?text=${encodeURIComponent(titulo + ' ' + url)}" target="_blank" class="opcao-compartilhar">
                        <i class="fab fa-whatsapp"></i> WhatsApp
                    </a>
                    <button onclick="copiarParaArea(event, '${url}')" class="opcao-compartilhar">
                        <i class="fas fa-link"></i> Copiar link
                    </button>
                </div>
                <button onclick="fecharModalCompartilhar()" class="botao-fechar">Fechar</button>
            </div>
            `;
        document.body.appendChild(modal);
        modal.style.display = 'flex';
    }

    function copiarParaArea(event, url) {
        navigator.clipboard.writeText(url).then(() => {
            mostrarToast('Link copiado!', 'sucesso');
            fecharModalCompartilhar();
        });
    }

    function fecharModalCompartilhar() {
        const modal = document.querySelector('.modal-compartilhar-custom');
        if (modal) modal.remove();
    }

    function mostrarToast(mensagem, tipo) {
        const toast = document.createElement('div');
        toast.className = `toast toast-${tipo}`;
        toast.textContent = mensagem;
        toast.style.cssText = `
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: ${tipo === 'sucesso' ? '#00b783' : '#DE1B24'};
            color: white;
            padding: 12px 20px;
            border-radius: 4px;
            font-size: 14px;
            z-index: 1000;
            animation: slideUp 0.3s ease;
        `;
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
    }
    const slider = document.querySelector('.carrossel');
    let isDown = false;
    let startX;
    let scrollLeft;

    slider.addEventListener('mousedown', (e) => {
        isDown = true;
        slider.classList.add('active');
        startX = e.pageX - slider.offsetLeft;
        scrollLeft = slider.scrollLeft;
    });

    slider.addEventListener('mouseleave', () => {
        isDown = false;
    });

    slider.addEventListener('mouseup', () => {
        isDown = false;
    });

    slider.addEventListener('mousemove', (e) => {
        if (!isDown) return;
        e.preventDefault();
        const x = e.pageX - slider.offsetLeft;
        const walk = (x - startX) * 2;
        slider.scrollLeft = scrollLeft - walk;
    });


</script>
</body>
</html>